<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Set Viral Videos & Download Link</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="admin-container">
        <h2>Admin Settings</h2>
        <fieldset>
            <legend>YouTube Videos</legend>
            <input type="text" id="video1" placeholder="YouTube URL 1 (e.g., https://www.youtube.com/watch?v=ID)">
            <input type="text" id="video2" placeholder="YouTube URL 2">
            <input type="text" id="video3" placeholder="YouTube URL 3">
            <input type="text" id="video4" placeholder="YouTube URL 4">
            <input type="text" id="video5" placeholder="YouTube URL 5">
            <button onclick="saveVideos()">OK</button>
        </fieldset>
        <fieldset>
            <legend>Download Link</legend>
            <input type="text" id="downloadLink" placeholder="Download URL (e.g., https://example.com)">
            <button onclick="saveDownloadLink()">OK</button>
        </fieldset>
    </div>

    <!-- Firebase SDK via CDN -->
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js"></script>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDDB8wgUqtfZUHx0qc6xT97L7oBp-k9nns",
            authDomain: "viral-cok.firebaseapp.com",
            projectId: "viral-cok",
            storageBucket: "viral-cok.firebasestorage.app",
            messagingSenderId: "465866226747",
            appId: "1:465866226747:web:cbe62190014be0f1bcf01e"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // Load videos and download link from Firestore when page loads
        window.onload = function() {
            // Load videos from Firestore
            const videoInputs = [
                document.getElementById('video1'),
                document.getElementById('video2'),
                document.getElementById('video3'),
                document.getElementById('video4'),
                document.getElementById('video5')
            ];

            videoInputs.forEach(function(input, index) {
                const docId = (index + 1).toString(); // Dokumen ID: '1', '2', '3', '4', '5'
                db.collection("videos").doc(docId).get()
                    .then(function(doc) {
                        if (doc.exists && doc.data().url) {
                            input.value = doc.data().url;
                        } else {
                            input.value = ''; // Kosongkan jika tidak ada data
                        }
                    })
                    .catch(function(error) {
                        console.error("Error loading video " + docId + ": ", error);
                        alert("Gagal memuat video " + (index + 1) + ". Periksa koneksi atau konsol browser.");
                    });
            });

            // Load download link from Firestore
            db.collection("settings").doc("download").get()
                .then(function(doc) {
                    if (doc.exists && doc.data().url) {
                        document.getElementById('downloadLink').value = doc.data().url;
                    } else {
                        document.getElementById('downloadLink').value = '';
                    }
                })
                .catch(function(error) {
                    console.error("Error loading download link: ", error);
                    alert("Gagal memuat tautan unduhan. Periksa koneksi atau konsol browser.");
                });
        };

        // Save videos to Firestore
        function saveVideos() {
            const videos = [
                document.getElementById('video1').value.trim(),
                document.getElementById('video2').value.trim(),
                document.getElementById('video3').value.trim(),
                document.getElementById('video4').value.trim(),
                document.getElementById('video5').value.trim()
            ];

            // Validate YouTube URLs
            const youtubeRegex = /^(https?:\/\/)?(www\.)?(youtube\.com|youtu\.be)\/(watch\?v=)?[A-Za-z0-9_-]+/;
            const validVideos = videos.map(function(url) {
                return youtubeRegex.test(url) || url === '' ? url : '';
            });

            // Save to Firestore
            validVideos.forEach(function(url, index) {
                const docId = (index + 1).toString(); // Dokumen ID: '1', '2', '3', '4', '5'
                if (url !== '') {
                    db.collection("videos").doc(docId).set({
                        url: url
                    })
                    .then(function() {
                        console.log("Video " + docId + " saved successfully.");
                    })
                    .catch(function(error) {
                        console.error("Error saving video " + docId + ": ", error);
                        alert("Gagal menyimpan video " + (index + 1) + ". Periksa koneksi atau konsol browser.");
                    });
                } else {
                    db.collection("videos").doc(docId).delete()
                        .then(function() {
                            console.log("Video " + docId + " deleted.");
                        })
                        .catch(function(error) {
                            console.error("Error deleting video " + docId + ": ", error);
                            alert("Gagal menghapus video " + (index + 1) + ". Periksa koneksi atau konsol browser.");
                        });
                }
            });

            alert("Videos processed successfully! Valid videos saved to Firestore.");
        }

        // Save download link to Firestore
        function saveDownloadLink() {
            const downloadLink = document.getElementById('downloadLink').value.trim();

            if (downloadLink === '') {
                db.collection("settings").doc("download").delete()
                    .then(function() {
                        alert("Download link cleared successfully.");
                    })
                    .catch(function(error) {
                        console.error("Error clearing download link: ", error);
                        alert("Gagal menghapus tautan unduhan. Periksa koneksi atau konsol browser.");
                    });
                return;
            }

            const urlRegex = /^(https?:\/\/)[^\s/$.?#].[^\s]*$/;
            if (urlRegex.test(downloadLink)) {
                db.collection("settings").doc("download").set({
                    url: downloadLink
                })
                .then(function() {
                    alert("Download link saved successfully!");
                })
                .catch(function(error) {
                    console.error("Error saving download link: ", error);
                    alert("Gagal menyimpan tautan unduhan. Periksa koneksi atau konsol browser.");
                });
            } else {
                alert("Please enter a valid URL (e.g., https://example.com).");
            }
        }
    </script>

    <!-- Cloudflare script (dipertahankan) -->
    <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'92fb04310912bfdd',t:'MTc0NDU0Nzg2My4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script>
</body>
</html>