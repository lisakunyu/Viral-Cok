<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Set Viral Videos & Download Link</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="admin-container">
        <h2>Admin Settings</h2>
        <fieldset>
            <legend>YouTube Videos</legend>
            <input type="text" id="video1" placeholder="YouTube URL 1 (e.g., https://www.youtube.com/watch?v=ID)">
            <input type="text" id="video2" placeholder="YouTube URL 2">
            <input type="text" id="video3" placeholder="YouTube URL 3">
            <input type="text" id="video4" placeholder="YouTube URL 4">
            <input type="text" id="video5" placeholder="YouTube URL 5">
            <button onclick="saveVideos()">OK</button>
        </fieldset>
        <fieldset>
            <legend>Download Link</legend>
            <input type="text" id="downloadLink" placeholder="Download URL (e.g., https://example.com)">
            <button onclick="saveDownloadLink()">OK</button>
        </fieldset>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-app.js";
        import { getFirestore } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDDB8wgUqtfZUHx0qc6xT97L7oBp-k9nns",
            authDomain: "viral-cok.firebaseapp.com",
            projectId: "viral-cok",
            storageBucket: "viral-cok.firebasestorage.app",
            messagingSenderId: "465866226747",
            appId: "1:465866226747:web:cbe62190014be0f1bcf01e"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        window.firestoreDb = db; // Membuat db tersedia secara global
    </script>

    <script>
        // Load saved videos and download link
        window.onload = async () => {
            const db = window.firestoreDb;
            const { doc, getDoc } = await import("https://www.gstatic.com/firebasejs/11.6.0/firebase-firestore.js");

            // Load videos
            const videoDocRef = doc(db, "videos", "list");
            const videoDoc = await getDoc(videoDocRef);
            const videos = videoDoc.exists() ? videoDoc.data().urls : ['', '', '', '', ''];
            document.getElementById('video1').value = videos[0] || '';
            document.getElementById('video2').value = videos[1] || '';
            document.getElementById('video3').value = videos[2] || '';
            document.getElementById('video4').value = videos[3] || '';
            document.getElementById('video5').value = videos[4] || '';

            // Load download link
            const downloadDocRef = doc(db, "settings", "download");
            const downloadDoc = await getDoc(downloadDocRef);
            const downloadLink = downloadDoc.exists() ? downloadDoc.data().url : '';
            document.getElementById('downloadLink').value = downloadLink;
        };

        async function saveVideos() {
            const db = window.firestoreDb;
            const { doc, setDoc } = await import("https://www.gstatic.com/firebasejs/11.6.0/firebase-firestore.js");

            const videos = [
                document.getElementById('video1').value.trim(),
                document.getElementById('video2').value.trim(),
                document.getElementById('video3').value.trim(),
                document.getElementById('video4').value.trim(),
                document.getElementById('video5').value.trim()
            ];

            // Validate URLs
            const validVideos = videos.map(url => {
                if (url === '') return url;
                const youtubeRegex = /^(https?:\/\/)?(www\.)?(youtube\.com|youtu\.be)\/(watch\?v=)?[A-Za-z0-9_-]+/;
                return youtubeRegex.test(url) ? url : '';
            });

            // Save to Firestore
            await setDoc(doc(db, "videos", "list"), { urls: validVideos });
            alert('Videos saved! Valid videos will play randomly on the main page.');
        }

        async function saveDownloadLink() {
            const db = window.firestoreDb;
            const { doc, setDoc } = await import("https://www.gstatic.com/firebasejs/11.6.0/firebase-firestore.js");

            const downloadLink = document.getElementById('downloadLink').value.trim();
            if (downloadLink === '') {
                await setDoc(doc(db, "settings", "download"), { url: '' });
                alert('Download link cleared.');
                return;
            }
            const urlRegex = /^(https?:\/\/)[^\s/$.?#].[^\s]*$/;
            if (urlRegex.test(downloadLink)) {
                await setDoc(doc(db, "settings", "download"), { url: downloadLink });
                alert('Download link saved! It will be available on the main page.');
            } else {
                alert('Please enter a valid URL (e.g., https://example.com).');
            }
        }
    </script>
</body>
</html>